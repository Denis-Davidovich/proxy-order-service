# API Documentation

## Overview

API документация генерируется с помощью **zircote/swagger-php** - легковесной библиотеки для создания OpenAPI 3.0 спецификаций.

## Endpoints

### Swagger Documentation

- **JSON спецификация**: `GET /api/doc.json`
  - Возвращает OpenAPI 3.0 спецификацию в формате JSON
  - Автоматически генерируется из PHP атрибутов в контроллерах

- **Swagger UI**: `GET /api/doc`
  - Интерактивная документация
  - Загружается с CDN (Swagger UI v5)
  - Позволяет тестировать API прямо из браузера

## Implementation

### Controller Annotations

Используются PHP 8+ атрибуты `OpenApi\Attributes`:

```php
use OpenApi\Attributes as OA;

#[Route('/api/v1/orders', name: 'create_order_rest', methods: ['POST'])]
#[OA\Post(
    path: '/api/v1/orders',
    tags: ['Orders'],
    summary: 'Создание нового заказа',
    description: 'Создание нового заказа через REST API',
    requestBody: new OA\RequestBody(
        description: 'Данные для создания заказа',
        content: new OA\JsonContent(
            type: 'object',
            properties: [
                new OA\Property(property: 'name', type: 'string', example: 'Заказ #123'),
                new OA\Property(property: 'client_name', type: 'string', example: 'Иван Иванов'),
                new OA\Property(property: 'email', type: 'string', format: 'email', example: 'ivan@example.com'),
            ]
        )
    ),
    responses: [
        new OA\Response(
            response: 201,
            description: 'Заказ успешно создан'
        )
    ]
)]
public function createOrder(Request $request): JsonResponse
{
    // ...
}
```

### API Info

Главная информация об API определена в `ApiDocController`:

```php
#[OA\Info(
    version: '1.0.0',
    title: 'Order Service API',
    description: 'Простое приложение для работы с заказами'
)]
#[OA\Server(
    url: 'http://localhost:8080',
    description: 'Development server'
)]
#[OA\Tag(name: 'Orders', description: 'Управление заказами')]
#[OA\Tag(name: 'Statistics', description: 'Статистика заказов')]
#[OA\Tag(name: 'Pricing', description: 'Получение цен на плитку')]
```

## Tags

API endpoints сгруппированы по тегам:

- **Orders**: Создание и получение заказов
- **Statistics**: Статистика заказов с группировкой и пагинацией
- **Pricing**: Получение цен на плитку с tile.expert

## Documented Endpoints

1. **POST /api/v1/orders** - Создание заказа
2. **GET /api/v1/orders/{id}** - Получение заказа по ID
3. **GET /api/v1/orders/stats** - Статистика заказов
4. **GET /api/v1/endpoint-1** - Получение цены плитки

## Testing

Тесты API документации находятся в `tests/Controller/ApiDocTest.php`:

- Проверка доступности `/api/doc.json`
- Проверка корректности OpenAPI спецификации
- Проверка наличия всех endpoints
- Проверка структуры документации

Запуск тестов:
```bash
make test
```

## Advantages

- ✅ Легковесное решение (без лишних зависимостей)
- ✅ Прямой контроль над OpenAPI спецификацией
- ✅ Swagger UI загружается с CDN (не нужны статические файлы)
- ✅ Чистая интеграция с PHP 8.4+ (атрибуты вместо аннотаций)
- ✅ OpenAPI 3.0 compatible

## Migration from NelmioApiDocBundle

Проект был мигрирован с NelmioApiDocBundle на zircote/swagger-php для упрощения и улучшения производительности.

Изменения:
- Удален `nelmio/api-doc-bundle` и его зависимости
- Установлен `zircote/swagger-php`
- Создан кастомный `ApiDocController` для генерации документации
- Обновлены все аннотации в контроллерах
- Добавлен Twig шаблон для Swagger UI
